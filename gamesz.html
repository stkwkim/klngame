<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹é¾åŸåœŸç“œç£æ¢ç´¢</title>
    <style>
        /* åŸºæœ¬æ¨£å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            color: #fff;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 600px;
            background: #fff;
            color: #333;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18);
            padding: 1.5rem;
            margin: 1rem;
            position: relative;
        }
        
        h1 {
            text-align: center;
            margin: 0 0 1.5rem 0;
            font-size: 1.75rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .progress-container {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .progress-bar {
            height: 0.5rem;
            background: #e9ecef;
            border-radius: 1rem;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .location-card {
            background: #f8f9fa;
            padding: 1.25rem;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }
        
        .location-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .location-card h2 {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: #343a40;
            display: flex;
            align-items: center;
        }
        
        .distance-badge {
            background: #e7f3ff;
            color: #004085;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        .btn {
            background: #667eea;
            color: #fff;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            margin: 0.25rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #000;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.875rem;
            margin: 0.5rem 0;
            transition: border-color 0.3s;
        }
        
        input:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            margin: 0.75rem 0;
        }
        
        .selfie-box {
            text-align: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #ddd;
        }
        
        .selfie-canvas {
            display: none;
        }
        
        .selfie-img {
            max-width: 100%;
            margin-top: 0.5rem;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .completion {
            text-align: center;
            padding: 1.5rem;
        }
        
        .qr-code {
            margin: 1.5rem 0;
        }
        
        .qr-code img {
            max-width: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 1rem;
        }
        
        .modal-content {
            background: #fff;
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 560px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            margin-bottom: 1rem;
            color: #343a40;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #fff;
            cursor: pointer;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
        }
        
        .poem-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.25rem;
            text-align: center;
            padding: 2rem;
            z-index: 9999;
            line-height: 1.8;
        }
        
        .poem-content {
            max-width: 500px;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(5px);
        }
        
        .gps-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #333;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            z-index: 9999;
            display: none;
            font-size: 0.875rem;
            max-width: 90%;
            width: 400px;
        }
        
        .gps-prompt button {
            margin: 0 4px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .location-card {
                padding: 1rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin: 0.25rem 0;
            }
            
            .poem-mask {
                font-size: 1.1rem;
                padding: 1rem;
            }
        }
        
        /* ä¿è­·æ¨£å¼ */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .no-context {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* æµ®æ°´å° */
        .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.03);
            z-index: -1;
            pointer-events: none;
            white-space: nowrap;
            font-weight: bold;
        }
    </style>
</head>
<body class="no-select no-context" oncontextmenu="return false;">
    <div class="watermark">ä¹é¾åŸåœŸç“œç£æ¢ç´¢</div>
    
    <div class="container">
        <h1>ğŸ›ï¸ ä¹é¾åŸåœŸç“œç£æ¢ç´¢</h1>
        
        <div class="progress-container">
            <div>æ¢ç´¢é€²åº¦ï¼š<span id="progress-count">0</span> / 6</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text">
                <span>å·²å®Œæˆï¼š<span id="progress-percent">0</span>%</span>
                <span>å‰©é¤˜ï¼š<span id="remaining-percent">100</span>%</span>
            </div>
        </div>

        <!-- å…§å®¹å°‡ç”±JavaScriptå‹•æ…‹è¼‰å…¥ -->
        <div id="game-content"></div>
    </div>

    <!-- å½±ç‰‡æ¨¡æ…‹æ¡† -->
    <div id="video-modal" class="modal" style="display:none;">
        <button class="modal-close" onclick="closeVideo()">&times;</button>
        <div class="modal-content">
            <h2 id="video-title">å½±ç‰‡æ¨™é¡Œ</h2>
            <p id="video-description">å½±ç‰‡æè¿°</p>
            <div class="video-container">
                <iframe id="video-player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <p style="font-size:0.75rem;color:#555;margin-top:0.5rem;">åœ¨ARç‰ˆæœ¬ä¸­ï¼Œé€™æ®µå½±ç‰‡æœƒåœ¨æ‚¨åˆ°é”åœ°é»æ™‚è‡ªå‹•æ’­æ”¾ï¼Œä¸¦èˆ‡å¯¦æ™¯çµåˆ</p>
        </div>
    </div>

    <!-- GPS æç¤º -->
    <div id="gpsPrompt" class="gps-prompt">
        <div>ğŸ“ ä½ å·²åˆ°é” <strong id="promptPoiName"></strong>ï¼</div>
        <div style="margin-top:8px">
            <button class="btn btn-info" onclick="playSelected('story')">æ’­æ”¾æ•…äº‹é€²åº¦</button>
            <button class="btn btn-danger" onclick="playSelected('hist')">æ’­æ”¾æ­·å²ç‰‡æ®µ</button>
            <button class="btn" onclick="closePrompt()">ç¨å¾Œå†èªª</button>
        </div>
    </div>

    <script>
        // ä»£ç¢¼ä¿è­·æªæ–½
        (function() {
            'use strict';
            
            // ç¦ç”¨å³éµèœå–®
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            // ç¦ç”¨æ–‡æœ¬é¸æ“‡
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // ç¦ç”¨æ‹–æ‹½
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // ç¦ç”¨è¤‡è£½ã€å‰ªåˆ‡ã€ç²˜è²¼
            document.addEventListener('copy', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('cut', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                return false;
            });
            
            // æª¢æ¸¬é–‹ç™¼è€…å·¥å…·
            function detectDevTools() {
                var threshold = 160;
                var widthThreshold = window.outerWidth - window.innerWidth > threshold;
                var heightThreshold = window.outerHeight - window.innerHeight > threshold;
                
                if (widthThreshold || heightThreshold) {
                    document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#333;color:white;font-size:24px;">ğŸš« ç¦æ­¢ä½¿ç”¨é–‹ç™¼è€…å·¥å…·</div>';
                }
            }
            
            setInterval(detectDevTools, 1000);
            
            // åœ¨æ§åˆ¶å°é¡¯ç¤ºè­¦å‘Š
            console.log('%cğŸš« è«‹å‹¿è¤‡è£½æ­¤ä»£ç¢¼', 'color: red; font-size: 20px; font-weight: bold;');
            console.log('%cæ­¤æ‡‰ç”¨ç¨‹å¼ä»£ç¢¼å—ç‰ˆæ¬Šä¿è­·', 'color: orange; font-size: 16px;');
        })();

        // éŠæˆ²ç‹€æ…‹
        var currentLocation = 1;
        var totalLocations = 6;
        var hintCounters = {1:0, 2:0, 3:0, 4:0, 5:0, 6:0};
        var completedLocations = new Set();

        // ä¸‹ä¸€åœ°é»è©©æ„æç¤º
        var nextPoem = {
            2: 'ç£šç“¦ç–Šç–Šï¼Œæ­²æœˆæ–‘æ–‘ï¼›ä¸‹ä¸€é ï¼Œé¨æ¨“å°‡æŠŠèˆŠå¤¢ç¿»éŸ¿ã€‚',
            3: 'éµé–˜èƒŒå¾Œï¼Œæ›¾ç¶“ç‰›è²ä½è¿´ï¼›ç´…ç£šå¾…ä½ ï¼ŒçºŒå¯«è—è¡“æ–°ç« ã€‚',
            4: 'æµ·é¢¨è¼•æ‹‚ï¼Œé­šå°¾çŸ³ä»å®ˆæœ›ï¼›æµªèŠ±è¦æŠŠä¸‹ä¸€æ®µæ•…äº‹äº¤åˆ°ä½ æ‰‹ä¸Šã€‚',
            5: 'å®‹å®¤éºç—•ï¼Œè‹”è˜šç”Ÿé¦™ï¼›è¸éçŸ³åˆ»ï¼Œå†è½ä¸€æ®µçš‡å®¤é¢¨éœœã€‚',
            6: 'é¦™ç«ç¹šç¹ï¼Œè§€éŸ³ä½çœ‰ï¼›å»Ÿç°·ä¸‹çš„é¢¨éˆ´ï¼Œæ­£ç‚ºä½ ä½œéŸ¿ã€‚'
        };

        // å‹•æ…‹è¼‰å…¥éŠæˆ²å…§å®¹
        function loadGameContent() {
            var content = '';
            
            // é¡Œç›®1
            content += '<div id="location-1" class="location-card">';
            content += '<h2>ğŸ“ ä¹é¾å¯¨åŸå…¬åœ’<span id="dist-1" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>';
            content += '<p><strong>æ•…äº‹ï¼š</strong>é€™è£¡æ›¾æ˜¯å……æ»¿å‚³å¥‡çš„ä¹é¾å¯¨åŸï¼Œä¸€å€‹åœ¨ä¸‰ä¸ç®¡åœ°å¸¶ä¸­è‡ªç„¶å½¢æˆçš„ç¨ç‰¹ç¤¾å€ã€‚</p>';
            content += '<div class="button-group">';
            content += '<button class="btn btn-danger" onclick="showVideo(1,\'history\')">ğŸ¬ æ­·å²å½±ç‰‡</button>';
            content += '<button class="btn btn-info" onclick="showVideo(1,\'story\')">ğŸ“– æ•…äº‹é€²åº¦</button>';
            content += '</div>';
            content += '<p><strong>å•é¡Œï¼š</strong>ä¹é¾å¯¨åŸå…¬åœ’ä¿ç•™äº†æ¸…ä»£è¡™é–€çš„å“ªå€‹é‡è¦å»ºç¯‰çµæ§‹ï¼Ÿ</p>';
            content += '<input type="text" id="answer-1" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">';
            content += '<div class="button-group">';
            content += '<button class="btn" onclick="checkAnswer(1,\'è¡™é–€\')">æäº¤ç­”æ¡ˆ</button>';
            content += '<button class="btn btn-warning" onclick="showHint(1)">ğŸ’¡ æç¤º (<span id="hint-count-1">0</span>/3)</button>';
            content += '</div>';
            content += '<div class="selfie-box">';
            content += '<button class="btn btn-success" onclick="takeSelfie(1)">ğŸ“¸ è‡ªæ‹åˆ†äº«</button>';
            content += '<canvas id="canvas-1" class="selfie-canvas" width="600" height="600"></canvas>';
            content += '<img id="selfie-1" class="selfie-img" style="display:none;">';
            content += '</div>';
            content += '</div>';
            
            // å…¶ä»–é¡Œç›®å°‡æ ¹æ“šé€²åº¦å‹•æ…‹è¼‰å…¥
            
            document.getElementById('game-content').innerHTML = content;
        }

        // æ›´æ–°é€²åº¦æ¢
        function updateProgress() {
            var completed = completedLocations.size;
            var pc = Math.min((completed / totalLocations) * 100, 100);
            
            document.getElementById('progress-count').textContent = completed;
            document.getElementById('progress-percent').textContent = Math.round(pc);
            document.getElementById('remaining-percent').textContent = Math.round(100 - pc);
            document.getElementById('progress-fill').style.width = pc + '%';
        }

        // é¡¯ç¤ºè©©æ„æç¤ºä¸¦å‰å¾€ä¸‹ä¸€åœ°é»
        function showPoemThenNext() {
            document.getElementById('location-' + currentLocation).style.display = 'none';
            completedLocations.add(currentLocation);
            updateProgress();
            
            var wrap = document.createElement('div');
            wrap.id = 'poem-mask';
            wrap.className = 'poem-mask';
            wrap.innerHTML = 
                '<div class="poem-content">' +
                    '<p>' + (nextPoem[currentLocation + 1] || '') + '</p>' +
                    '<button class="btn btn-success" onclick="goNextLocation()">æ¢ç´¢ä¸‹å€‹åœ°é»</button>' +
                '</div>';
            document.body.appendChild(wrap);
        }

        // å‰å¾€ä¸‹ä¸€åœ°é»
        function goNextLocation() {
            var mask = document.getElementById('poem-mask');
            if (mask) mask.remove();
            
            currentLocation++;
            
            if (currentLocation <= totalLocations) {
                // å‹•æ…‹è¼‰å…¥ä¸‹ä¸€å€‹åœ°é»
                loadLocation(currentLocation);
            } else {
                completeGame();
            }
        }

        // å‹•æ…‹è¼‰å…¥åœ°é»
        function loadLocation(locationNum) {
            var content = '';
            
            if (locationNum === 2) {
                content += '<div id="location-2" class="location-card">';
                content += '<h2>ğŸ¢ åä¸‰è¡—èˆŠæ¨“ç¾¤<span id="dist-2" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>';
                content += '<p><strong>æ•…äº‹ï¼š</strong>åä¸‰è¡—è¦‹è­‰äº†åœŸç“œç£çš„å·¥æ¥­ç™¼å±•å²ï¼Œæˆ°å‰é¨æ¨“èåˆä¸­è¥¿é¢¨æ ¼ã€‚</p>';
                content += '<div class="button-group">';
                content += '<button class="btn btn-danger" onclick="showVideo(2,\'history\')">ğŸ¬ æ­·å²å½±ç‰‡</button>';
                content += '<button class="btn btn-info" onclick="showVideo(2,\'story\')">ğŸ“– æ•…äº‹é€²åº¦</button>';
                content += '</div>';
                content += '<p><strong>å•é¡Œï¼š</strong>åä¸‰è¡—çš„é¨æ¨“å»ºç¯‰ä¸»è¦å»ºæ–¼å“ªå€‹å¹´ä»£ï¼Ÿï¼ˆå››ä½æ•¸å­—ï¼‰</p>';
                content += '<input type="text" id="answer-2" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">';
                content += '<div class="button-group">';
                content += '<button class="btn" onclick="checkAnswer(2,\'1950\')">æäº¤ç­”æ¡ˆ</button>';
                content += '<button class="btn btn-warning" onclick="showHint(2)">ğŸ’¡ æç¤º (<span id="hint-count-2">0</span>/3)</button>';
                content += '</div>';
                content += '<div class="selfie-box">';
                content += '<button class="btn btn-success" onclick="takeSelfie(2)">ğŸ“¸ è‡ªæ‹åˆ†äº«</button>';
                content += '<canvas id="canvas-2" class="selfie-canvas" width="600" height="600"></canvas>';
                content += '<img id="selfie-2" class="selfie-img" style="display:none;">';
                content += '</div>';
                content += '</div>';
            }
            // å…¶ä»–åœ°é»çš„HTMLä»£ç¢¼å¯ä»¥åœ¨é€™è£¡æ·»åŠ 
            
            document.getElementById('game-content').innerHTML = content;
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer(locationNum, correctAnswer) {
            var userAnswer = document.getElementById('answer-' + locationNum).value.trim().toLowerCase();
            var correct = correctAnswer.toLowerCase();
            var isCorrect = false;
            
            // åš´æ ¼æ¯”å°é‚è¼¯
            if (userAnswer === correct) {
                isCorrect = true;
            }
            // é‡å°ç‰¹å®šé¡Œç›®çš„å¯¬é¬†æ¯”å°
            if (locationNum === 2 && (userAnswer === '50å¹´ä»£' || userAnswer === 'äº”åå¹´ä»£')) {
                isCorrect = true;
            }

            if (isCorrect) {
                document.getElementById('answer-' + locationNum).value = '';
                showPoemThenNext(); // åªæœ‰æ­£ç¢ºæ‰é¡¯ç¤ºè©©å¥
            } else {
                alert('âŒ ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡æˆ–æŸ¥çœ‹æç¤ºã€‚');
            }
        }

        // é¡¯ç¤ºæç¤º
        function showHint(locationNum) {
            hintCounters[locationNum]++;
            document.getElementById('hint-count-' + locationNum).textContent = hintCounters[locationNum];
            
            var hints = {
                1: {
                    1: 'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å•é¡Œä¸­ï¼ç•™æ„ã€Œè¡™é–€ã€é€™å€‹è©ã€‚', 
                    2: 'æç¤ºï¼šæ¸…ä»£è¡™é–€çš„é‡è¦å»ºç¯‰çµæ§‹å°±æ˜¯ã€Œè¡™é–€ã€æœ¬èº«ã€‚', 
                    3: 'ç­”æ¡ˆï¼šè¡™é–€'
                },
                2: {
                    1: 'æç¤ºï¼šæƒ³æƒ³é¦™æ¸¯æˆ°å¾Œé‡å»ºçš„æ™‚æœŸï¼Œç­”æ¡ˆæ˜¯å››ä½æ•¸å­—ã€‚', 
                    2: 'æç¤ºï¼š1950å¹´ä»£æ˜¯é¦™æ¸¯æˆ°å¾Œé‡å»ºçš„é‡è¦æ™‚æœŸã€‚', 
                    3: 'ç­”æ¡ˆï¼š1950'
                },
                3: {
                    1: 'æç¤ºï¼šé€™å€‹åœ°æ–¹åŸæœ¬çš„ç”¨é€”èˆ‡ã€Œç‰›ã€æœ‰é—œï¼Œç­”æ¡ˆæ˜¯ä¸‰å€‹å­—ã€‚', 
                    2: 'æç¤ºï¼šé€™è£¡åŸæœ¬æ˜¯è™•ç†ç‰›éš»çš„åœ°æ–¹ã€‚', 
                    3: 'ç­”æ¡ˆï¼šå± å®°å ´'
                },
                4: {
                    1: 'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å•é¡Œä¸­ï¼æ˜¯ä¸€ç¨®èˆ‡æµ·æ´‹ç”Ÿç‰©æœ‰é—œçš„çŸ³é ­ã€‚', 
                    2: 'æç¤ºï¼šé€™ç¨®çŸ³é ­å½¢ç‹€åƒé­šçš„å°¾å·´ã€‚', 
                    3: 'ç­”æ¡ˆï¼šé­šå°¾çŸ³'
                },
                5: {
                    1: 'æç¤ºï¼šæƒ³æƒ³ä¸­åœ‹æ­·å²ä¸­å—åŒ—å®‹çš„æ™‚æœŸï¼Œç­”æ¡ˆæ˜¯å…©å€‹å­—ã€‚', 
                    2: 'æç¤ºï¼šå—å®‹æ˜¯å®‹æœçš„å¾ŒæœŸéšæ®µã€‚', 
                    3: 'ç­”æ¡ˆï¼šå—å®‹'
                },
                6: {
                    1: 'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å»Ÿå®‡åç¨±ä¸­ï¼', 
                    2: 'æç¤ºï¼šè§€éŸ³å»Ÿä¸»è¦ä¾›å¥‰çš„å°±æ˜¯è§€éŸ³è©è–©ã€‚', 
                    3: 'ç­”æ¡ˆï¼šè§€éŸ³'
                }
            };
            
            alert(hints[locationNum][Math.min(hintCounters[locationNum], 3)]);
            
            if (hintCounters[locationNum] === 3) {
                setTimeout(function() { 
                    hintCounters[locationNum] = 0; 
                    document.getElementById('hint-count-' + locationNum).textContent = '0'; 
                }, 2000);
            }
        }

        // é¡¯ç¤ºå½±ç‰‡
        function showVideo(locationNum, type) {
            var videoInfo = {
                1: {
                    history: {title: 'ä¹é¾å¯¨åŸæ­·å²', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'ä¹é¾å¯¨åŸæ•…äº‹é€²åº¦', youtubeId: 'dQw4w9WgXcQ'}
                },
                2: {
                    history: {title: 'åä¸‰è¡—èˆŠæ¨“ç¾¤æ•…äº‹', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'åä¸‰è¡—ç™¼å±•æ•…äº‹', youtubeId: 'dQw4w9WgXcQ'}
                },
                3: {
                    history: {title: 'ç‰›æ£šè—è¡“æ‘è½‰å‹', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'ç‰›æ£šè—è¡“æ‘æ•…äº‹', youtubeId: 'dQw4w9WgXcQ'}
                },
                4: {
                    history: {title: 'æµ·å¿ƒå…¬åœ’èˆ‡é­šå°¾çŸ³å‚³èªª', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'æµ·å¿ƒå…¬åœ’æ•…äº‹', youtubeId: 'dQw4w9WgXcQ'}
                },
                5: {
                    history: {title: 'å®‹çš‡è‡ºæ­·å²éºè·¡', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'å®‹çš‡è‡ºæ•…äº‹', youtubeId: 'dQw4w9WgXcQ'}
                },
                6: {
                    history: {title: 'ç´…ç£¡è§€éŸ³å»Ÿæ–‡åŒ–', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'ç´…ç£¡è§€éŸ³å»Ÿæ•…äº‹', youtubeId: 'dQw4w9WgXcQ'}
                }
            };
            
            var info = videoInfo[locationNum][type];
            document.getElementById('video-title').textContent = info.title;
            document.getElementById('video-description').textContent = info.title;
            document.getElementById('video-player').src = 'https://www.youtube.com/embed/' + info.youtubeId + '?autoplay=1&rel=0';
            document.getElementById('video-modal').style.display = 'flex';
        }

        // é—œé–‰å½±ç‰‡
        function closeVideo() {
            document.getElementById('video-modal').style.display = 'none';
            document.getElementById('video-player').src = '';
        }

        // å®ŒæˆéŠæˆ²
        function completeGame() {
            document.getElementById('game-content').innerHTML = '';
            
            var completionHTML = '<div id="completion" class="completion">';
            completionHTML += '<h2>ğŸ‰ æ­å–œæ‚¨å®Œæˆæ‰€æœ‰æ¢ç´¢ï¼</h2>';
            completionHTML += '<p>æ‚¨å·²æˆåŠŸå®Œæˆä¹é¾åŸåœŸç“œç£çš„ 6 å€‹æ­·å²åœ°é»æ¢ç´¢ï¼</p>';
            completionHTML += '<div class="qr-code">';
            completionHTML += '<h3>å®Œæˆçå‹µäºŒç¶­ç¢¼</h3>';
            completionHTML += '<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=ä¹é¾åŸåœŸç“œç£æ¢ç´¢å®Œæˆ&format=png&margin=0" alt="å®Œæˆçå‹µ">';
            completionHTML += '<p class="qr-instruction">æƒææ­¤äºŒç¶­ç¢¼å¯ç²å¾—æ•¸å­—ä»£ç¢¼</p>';
            completionHTML += '</div>';
            completionHTML += '<div class="selfie-box">';
            completionHTML += '<button class="btn btn-success" onclick="takeSelfie(0)">ğŸ“¸ è‡ªæ‹åˆ†äº«å®Œæˆä»»å‹™</button>';
            completionHTML += '<canvas id="canvas-0" class="selfie-canvas" width="600" height="600"></canvas>';
            completionHTML += '<img id="selfie-0" class="selfie-img" style="display:none;">';
            completionHTML += '</div>';
            completionHTML += '<button class="btn btn-success" onclick="resetGame()">é‡æ–°é–‹å§‹éŠæˆ²</button>';
            completionHTML += '</div>';
            
            document.getElementById('game-content').innerHTML = completionHTML;
            updateProgress();
        }

        // é‡ç½®éŠæˆ²
        function resetGame() {
            currentLocation = 1;
            completedLocations.clear();
            hintCounters = {1:0, 2:0, 3:0, 4:0, 5:0, 6:0};
            loadGameContent();
            updateProgress();
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            loadGameContent();
            updateProgress();
        });

        // ç°¡åŒ–çš„è‡ªæ‹åŠŸèƒ½
        function takeSelfie(locationNum) {
            var canvas = document.getElementById('canvas-' + locationNum);
            var ctx = canvas.getContext('2d');
            var img = document.getElementById('selfie-' + locationNum);
            
            // ç¹ªè£½èƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 600, 600);
            
            // ç¹ªè£½æ–‡å­—
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            
            var site = locationNum === 0 ? 'ä¹é¾åŸåœŸç“œç£æ¢ç´¢' : getLocationName(locationNum);
            ctx.fillText('æˆ‘å·²å®Œæˆã€' + site + 'ã€‘ä»»å‹™ï¼', 300, 300);
            
            // ç¹ªè£½ç°¡å–®çš„ç›¸æ©Ÿåœ–æ¨™
            ctx.fillStyle = '#333333';
            ctx.fillRect(250, 400, 100, 80);
            ctx.fillStyle = '#cccccc';
            ctx.fillRect(270, 420, 60, 40);
            
            // é¡¯ç¤ºåœ–ç‰‡
            var dataURL = canvas.toDataURL('image/jpeg', 0.9);
            img.src = dataURL;
            img.style.display = 'block';
            
            // æ¨¡æ“¬åˆ†äº«åˆ°WhatsApp
            setTimeout(function() {
                if (confirm('æ˜¯å¦è¦åˆ†äº«åˆ° WhatsAppï¼Ÿ')) {
                    window.open('https://wa.me/?text=' + encodeURIComponent('æˆ‘å·²å®Œæˆã€' + site + 'ã€‘ä»»å‹™ï¼'), '_blank');
                }
            }, 500);
        }

        // ç²å–åœ°é»åç¨±
        function getLocationName(locationNum) {
            var locations = {
                1: 'ä¹é¾å¯¨åŸå…¬åœ’',
                2: 'åä¸‰è¡—èˆŠæ¨“ç¾¤',
                3: 'ç‰›æ£šè—è¡“æ‘',
                4: 'æµ·å¿ƒå…¬åœ’',
                5: 'å®‹çš‡è‡ºå…¬åœ’',
                6: 'ç´…ç£¡è§€éŸ³å»Ÿ'
            };
            return locations[locationNum] || 'æœªçŸ¥åœ°é»';
        }

        // ç°¡åŒ–çš„GPSåŠŸèƒ½
        function simulateGPS() {
            var distances = [150, 320, 85, 420, 210, 180];
            
            for (var i = 1; i <= 6; i++) {
                var badge = document.getElementById('dist-' + i);
                if (badge) {
                    badge.textContent = distances[i-1] + ' m';
                    
                    // æ¨¡æ“¬åˆ°é”åœ°é»
                    if (distances[i-1] < 200 && !completedLocations.has(i)) {
                        showGPSPrompt(i);
                    }
                }
            }
        }

        // é¡¯ç¤ºGPSæç¤º
        function showGPSPrompt(poiId) {
            var prompt = document.getElementById('gpsPrompt');
            var poiName = getLocationName(poiId);
            
            document.getElementById('promptPoiName').textContent = poiName;
            prompt.dataset.poiId = poiId;
            prompt.style.display = 'block';
            
            // 5ç§’å¾Œè‡ªå‹•éš±è—
            setTimeout(function() {
                if (prompt.style.display === 'block') {
                    prompt.style.display = 'none';
                }
            }, 5000);
        }

        // é—œé–‰GPSæç¤º
        function closePrompt() {
            document.getElementById('gpsPrompt').style.display = 'none';
        }

        // æ’­æ”¾é¸æ“‡çš„å½±ç‰‡
        function playSelected(type) {
            var poiId = document.getElementById('gpsPrompt').dataset.poiId;
            closePrompt();
            showVideo(poiId, type === 'story' ? 'story' : 'history');
        }

        // åˆå§‹åŒ–GPSæ¨¡æ“¬
        setInterval(simulateGPS, 3000);
    </script>
</body>
</html>
