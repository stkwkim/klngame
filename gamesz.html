<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±åœ³åŸå¸‚æ¢ç´¢</title>
    <style>
        /* åŸºæœ¬æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #0078d7 0%, #00a4ef 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            color: #fff;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 600px;
            background: #fff;
            color: #333;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18);
            padding: 1.5rem;
            margin: 1rem;
            position: relative;
        }
        
        h1 {
            text-align: center;
            margin: 0 0 1.5rem 0;
            font-size: 1.75rem;
            background: linear-gradient(45deg, #0078d7, #00a4ef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .progress-container {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .progress-bar {
            height: 0.5rem;
            background: #e9ecef;
            border-radius: 1rem;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #107c10, #20c997);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .location-card {
            background: #f8f9fa;
            padding: 1.25rem;
            border-left: 4px solid #0078d7;
            border-radius: 8px;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }
        
        .location-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .location-card h2 {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: #323130;
            display: flex;
            align-items: center;
        }
        
        .distance-badge {
            background: #e7f3ff;
            color: #004085;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        .btn {
            background: #0078d7;
            color: #fff;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            margin: 0.25rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            background: #0066b4;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #107c10;
        }
        
        .btn-warning {
            background: #ffb900;
            color: #000;
        }
        
        .btn-danger {
            background: #d13438;
        }
        
        .btn-info {
            background: #8661c5;
        }
        
        input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.875rem;
            margin: 0.5rem 0;
            transition: border-color 0.3s;
        }
        
        input:focus {
            border-color: #0078d7;
            outline: none;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            margin: 0.75rem 0;
        }
        
        .selfie-box {
            text-align: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #ddd;
        }
        
        .selfie-canvas {
            display: none;
        }
        
        .selfie-img {
            max-width: 100%;
            margin-top: 0.5rem;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .completion {
            text-align: center;
            padding: 1.5rem;
        }
        
        .qr-code {
            margin: 1.5rem 0;
        }
        
        .qr-code img {
            max-width: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 1rem;
        }
        
        .modal-content {
            background: #fff;
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 560px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            margin-bottom: 1rem;
            color: #323130;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #fff;
            cursor: pointer;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
        }
        
        .poem-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.25rem;
            text-align: center;
            padding: 2rem;
            z-index: 9999;
            line-height: 1.8;
        }
        
        .poem-content {
            max-width: 500px;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(5px);
        }
        
        .gps-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #333;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            z-index: 9999;
            display: none;
            font-size: 0.875rem;
            max-width: 90%;
            width: 400px;
        }
        
        .gps-prompt button {
            margin: 0 4px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .location-card {
                padding: 1rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin: 0.25rem 0;
            }
            
            .poem-mask {
                font-size: 1.1rem;
                padding: 1rem;
            }
        }
        
        /* ä¿æŠ¤æ ·å¼ */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .no-context {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* æµ®æ°´å° */
        .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.03);
            z-index: -1;
            pointer-events: none;
            white-space: nowrap;
            font-weight: bold;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 0.25rem;
            font-size: 0.75rem;
            color: #666;
        }
    </style>
</head>
<body class="no-select no-context" oncontextmenu="return false;">
    <div class="watermark">æ·±åœ³åŸå¸‚æ¢ç´¢</div>
    
    <div class="container">
        <h1>ğŸ™ï¸ æ·±åœ³åŸå¸‚æ¢ç´¢ - æ”¹é©ä¹‹è·¯</h1>
        
        <div class="progress-container">
            <div>æ¢ç´¢è¿›åº¦ï¼š<span id="progress-count">0</span> / 6</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text">
                <span>å·²å®Œæˆï¼š<span id="progress-percent">0</span>%</span>
                <span>å‰©ä½™ï¼š<span id="remaining-percent">100</span>%</span>
            </div>
        </div>

        <!-- å†…å®¹å°†ç”±JavaScriptåŠ¨æ€åŠ è½½ -->
        <div id="game-content"></div>
    </div>

    <!-- å½±ç‰‡æ¨¡æ€æ¡† -->
    <div id="video-modal" class="modal" style="display:none;">
        <button class="modal-close" onclick="closeVideo()">&times;</button>
        <div class="modal-content">
            <h2 id="video-title">å½±ç‰‡æ ‡é¢˜</h2>
            <p id="video-description">å½±ç‰‡æè¿°</p>
            <div class="video-container">
                <iframe id="video-player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <p style="font-size:0.75rem;color:#555;margin-top:0.5rem;">åœ¨ARç‰ˆæœ¬ä¸­ï¼Œè¿™æ®µå½±ç‰‡ä¼šåœ¨æ‚¨åˆ°è¾¾åœ°ç‚¹æ—¶è‡ªåŠ¨æ’­æ”¾ï¼Œå¹¶ä¸å®æ™¯ç»“åˆ</p>
        </div>
    </div>

    <!-- GPS æç¤º -->
    <div id="gpsPrompt" class="gps-prompt">
        <div>ğŸ“ ä½ å·²åˆ°è¾¾ <strong id="promptPoiName"></strong>ï¼</div>
        <div style="margin-top:8px">
            <button class="btn btn-info" onclick="playSelected('story')">æ’­æ”¾æ•…äº‹è¿›åº¦</button>
            <button class="btn btn-danger" onclick="playSelected('hist')">æ’­æ”¾å†å²ç‰‡æ®µ</button>
            <button class="btn" onclick="closePrompt()">ç¨åå†è¯´</button>
        </div>
    </div>

    <script>
        // ä»£ç ä¿æŠ¤æªæ–½
        (function() {
            'use strict';
            
            // ç¦ç”¨å³é”®èœå•
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            // ç¦ç”¨æ–‡æœ¬é€‰æ‹©
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // ç¦ç”¨æ‹–æ‹½
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // ç¦ç”¨å¤åˆ¶ã€å‰ªåˆ‡ã€ç²˜è´´
            document.addEventListener('copy', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('cut', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                return false;
            });
            
            // æ£€æµ‹å¼€å‘è€…å·¥å…·
            function detectDevTools() {
                var threshold = 160;
                var widthThreshold = window.outerWidth - window.innerWidth > threshold;
                var heightThreshold = window.outerHeight - window.innerHeight > threshold;
                
                if (widthThreshold || heightThreshold) {
                    document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#333;color:white;font-size:24px;">ğŸš« ç¦æ­¢ä½¿ç”¨å¼€å‘è€…å·¥å…·</div>';
                }
            }
            
            setInterval(detectDevTools, 1000);
            
            // åœ¨æ§åˆ¶å°æ˜¾ç¤ºè­¦å‘Š
            console.log('%cğŸš« è¯·å‹¿å¤åˆ¶æ­¤ä»£ç ', 'color: red; font-size: 20px; font-weight: bold;');
            console.log('%cæ­¤åº”ç”¨ç¨‹åºä»£ç å—ç‰ˆæƒä¿æŠ¤', 'color: orange; font-size: 16px;');
        })();

        // æ¸¸æˆçŠ¶æ€
        var currentLocation = 1;
        var totalLocations = 6;
        var hintCounters = {1:0, 2:0, 3:0, 4:0, 5:0, 6:0};
        var completedLocations = new Set();

        // ä¸‹ä¸€åœ°ç‚¹è¯—æ„æç¤º
        var nextPoem = {
            2: 'ä»å†å²çš„æ²‰æ·€èµ°å‘ç§‘æŠ€çš„è„‰æï¼Œä¸‹ä¸€ç«™æ˜¯ç”µå­äº§ä¸šçš„ä¼ å¥‡ä¹‹åœ°ã€‚',
            3: 'ç§‘æŠ€ä¸è‡ªç„¶äº¤æ±‡ï¼Œä¸‹ä¸€ç«™å°†å¸¦ä½ ç™»é«˜æœ›è¿œï¼Œä¿¯ç°æ·±åœ³çš„åŸå¸‚è„‰ç»œã€‚',
            4: 'åŸå¸‚ä¹‹å·…ä¿¯ç°åï¼Œè®©æˆ‘ä»¬èµ°è¿‘è±¡å¾æ·±åœ³ç²¾ç¥çš„æ ‡å¿—æ€§é›•å¡‘ã€‚',
            5: 'æ„Ÿå—æ·±åœ³ç²¾ç¥åï¼Œä¸‹ä¸€ç«™å°†å¸¦ä½ è·¨è¶Šæ·±æ¸¯ï¼Œè§è¯ä¸¤åœ°åˆä½œçš„æ¡¥æ¢ã€‚',
            6: 'ä»è¿æ¥ä¸¤åœ°çš„æ¡¥æ¢ï¼Œèµ°å‘æœªæ¥å‘å±•çš„è¯•éªŒç”°ï¼Œå®Œæˆä½ çš„æ·±åœ³æ¢ç´¢ä¹‹æ—…ã€‚'
        };

        // åŠ¨æ€åŠ è½½æ¸¸æˆå†…å®¹
        function loadGameContent() {
            var content = '';
            
            // é¢˜ç›®1
            content += '<div id="location-1" class="location-card">';
            content += '<h2>ğŸ“ æ·±åœ³åšç‰©é¦†<span id="dist-1" class="distance-badge">è®¡ç®—ä¸­â€¦</span></h2>';
            content += '<p><strong>æ•…äº‹ï¼š</strong>æ·±åœ³åšç‰©é¦†æ˜¯äº†è§£æ·±åœ³ä»è¾¹é™²å°é•‡åˆ°ç°ä»£åŒ–å¤§éƒ½å¸‚å˜è¿çš„æœ€ä½³åœºæ‰€ï¼Œè®°å½•ç€æ”¹é©å¼€æ”¾çš„å†å²è¶³è¿¹ã€‚</p>';
            content += '<div class="button-group">';
            content += '<button class="btn btn-danger" onclick="showVideo(1,\'history\')">ğŸ¬ å†å²å½±ç‰‡</button>';
            content += '<button class="btn btn-info" onclick="showVideo(1,\'story\')">ğŸ“– æ•…äº‹è¿›åº¦</button>';
            content += '</div>';
            content += '<p><strong>é—®é¢˜ï¼š</strong>æ·±åœ³åšç‰©é¦†æ–°é¦†ä½äºæ·±åœ³çš„å“ªä¸ªè¡Œæ”¿åŒºï¼Ÿ</p>';
            content += '<input type="text" id="answer-1" placeholder="è¾“å…¥æ‚¨çš„ç­”æ¡ˆ">';
            content += '<div class="button-group">';
            content += '<button class="btn" onclick="checkAnswer(1,\'ç¦ç”°åŒº\')">æäº¤ç­”æ¡ˆ</button>';
            content += '<button class="btn btn-warning" onclick="showHint(1)">ğŸ’¡ æç¤º (<span id="hint-count-1">0</span>/3)</button>';
            content += '</div>';
            content += '<div class="selfie-box">';
            content += '<button class="btn btn-success" onclick="takeSelfie(1)">ğŸ“¸ è‡ªæ‹åˆ†äº«</button>';
            content += '<canvas id="canvas-1" class="selfie-canvas" width="600" height="600"></canvas>';
            content += '<img id="selfie-1" class="selfie-img" style="display:none;">';
            content += '</div>';
            content += '</div>';
            
            document.getElementById('game-content').innerHTML = content;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            var completed = completedLocations.size;
            var pc = Math.min((completed / totalLocations) * 100, 100);
            
            document.getElementById('progress-count').textContent = completed;
            document.getElementById('progress-percent').textContent = Math.round(pc);
            document.getElementById('remaining-percent').textContent = Math.round(100 - pc);
            document.getElementById('progress-fill').style.width = pc + '%';
        }

        // æ˜¾ç¤ºè¯—æ„æç¤ºå¹¶å‰å¾€ä¸‹ä¸€åœ°ç‚¹
        function showPoemThenNext() {
            document.getElementById('location-' + currentLocation).style.display = 'none';
            completedLocations.add(currentLocation);
            updateProgress();
            
            var wrap = document.createElement('div');
            wrap.id = 'poem-mask';
            wrap.className = 'poem-mask';
            wrap.innerHTML = 
                '<div class="poem-content">' +
                    '<p>' + (nextPoem[currentLocation + 1] || '') + '</p>' +
                    '<button class="btn btn-success" onclick="goNextLocation()">æ¢ç´¢ä¸‹ä¸ªåœ°ç‚¹</button>' +
                '</div>';
            document.body.appendChild(wrap);
        }

        // å‰å¾€ä¸‹ä¸€åœ°ç‚¹
        function goNextLocation() {
            var mask = document.getElementById('poem-mask');
            if (mask) mask.remove();
            
            currentLocation++;
            
            if (currentLocation <= totalLocations) {
                // åŠ¨æ€åŠ è½½ä¸‹ä¸€ä¸ªåœ°ç‚¹
                loadLocation(currentLocation);
            } else {
                completeGame();
            }
        }

        // åŠ¨æ€åŠ è½½åœ°ç‚¹
        function loadLocation(locationNum) {
            var content = '';
            
            if (locationNum === 2) {
                content += '<div id="location-2" class="location-card">';
                content += '<h2>ğŸ¢ åå¼ºåŒ—ç”µå­å¸‚åœº<span id="dist-2" class="distance-badge">è®¡ç®—ä¸­â€¦</span></h2>';
                content += '<p><strong>æ•…äº‹ï¼š</strong>åå¼ºåŒ—è¢«ç§°ä¸º"ä¸­å›½ç”µå­ç¬¬ä¸€è¡—"ï¼Œæ˜¯æ·±åœ³ç”µå­äº§ä¸šå‘å±•çš„ç¼©å½±ï¼Œè§è¯äº†æ·±åœ³ä»åˆ¶é€ åˆ°åˆ›é€ çš„è½¬å˜ã€‚</p>';
                content += '<div class="button-group">';
                content += '<button class="btn btn-danger" onclick="showVideo(2,\'history\')">ğŸ¬ å†å²å½±ç‰‡</button>';
                content += '<button class="btn btn-info" onclick="showVideo(2,\'story\')">ğŸ“– æ•…äº‹è¿›åº¦</button>';
                content += '</div>';
                content += '<p><strong>é—®é¢˜ï¼š</strong>åå¼ºåŒ—ç”µå­å¸‚åœºæœ€åˆä»¥ä»€ä¹ˆç”µå­äº§å“é—»åå…¨å›½ï¼Ÿ</p>';
                content += '<input type="text" id="answer-2" placeholder="è¾“å…¥æ‚¨çš„ç­”æ¡ˆ">';
                content += '<div class="button-group">';
                content += '<button class="btn" onclick="checkAnswer(2,\'æ‰‹æœº\')">æäº¤ç­”æ¡ˆ</button>';
                content += '<button class="btn btn-warning" onclick="showHint(2)">ğŸ’¡ æç¤º (<span id="hint-count-2">0</span>/3)</button>';
                content += '</div>';
                content += '<div class="selfie-box">';
                content += '<button class="btn btn-success" onclick="takeSelfie(2)">ğŸ“¸ è‡ªæ‹åˆ†äº«</button>';
                content += '<canvas id="canvas-2" class="selfie-canvas" width="600" height="600"></canvas>';
                content += '<img id="selfie-2" class="selfie-img" style="display:none;">';
                content += '</div>';
                content += '</div>';
            }
            else if (locationNum === 3) {
                content += '<div id="location-3" class="location-card">';
                content += '<h2>ğŸï¸ è²èŠ±å±±å…¬å›­<span id="dist-3" class="distance-badge">è®¡ç®—ä¸­â€¦</span></h2>';
                content += '<p><strong>æ•…äº‹ï¼š</strong>è²èŠ±å±±å…¬å›­æ˜¯æ·±åœ³ä¸­å¿ƒåŒºçš„é‡è¦ç»¿åœ°ï¼Œå±±é¡¶çš„é‚“å°å¹³é“œåƒè±¡å¾ç€æ·±åœ³çš„æ”¹é©å¼€æ”¾ç²¾ç¥ã€‚</p>';
                content += '<div class="button-group">';
                content += '<button class="btn btn-danger" onclick="showVideo(3,\'history\')">ğŸ¬ å†å²å½±ç‰‡</button>';
                content += '<button class="btn btn-info" onclick="showVideo(3,\'story\')">ğŸ“– æ•…äº‹è¿›åº¦</button>';
                content += '</div>';
                content += '<p><strong>é—®é¢˜ï¼š</strong>è²èŠ±å±±å…¬å›­å±±é¡¶çš„é‚“å°å¹³é“œåƒé¢å‘å“ªä¸ªæ–¹å‘ï¼Ÿ</p>';
                content += '<input type="text" id="answer-3" placeholder="è¾“å…¥æ‚¨çš„ç­”æ¡ˆ">';
                content += '<div class="button-group">';
                content += '<button class="btn" onclick="checkAnswer(3,\'å—æ–¹\')">æäº¤ç­”æ¡ˆ</button>';
                content += '<button class="btn btn-warning" onclick="showHint(3)">ğŸ’¡ æç¤º (<span id="hint-count-3">0</span>/3)</button>';
                content += '</div>';
                content += '<div class="selfie-box">';
                content += '<button class="btn btn-success" onclick="takeSelfie(3)">ğŸ“¸ è‡ªæ‹åˆ†äº«</button>';
                content += '<canvas id="canvas-3" class="selfie-canvas" width="600" height="600"></canvas>';
                content += '<img id="selfie-3" class="selfie-img" style="display:none;">';
                content += '</div>';
                content += '</div>';
            }
            else if (locationNum === 4) {
                content += '<div id="location-4" class="location-card">';
                content += '<h2>ğŸ›ï¸ æ·±åœ³å¸‚å§”å¤§é™¢åŠå­ºå­ç‰›é›•å¡‘<span id="dist-4" class="distance-badge">è®¡ç®—ä¸­â€¦</span></h2>';
                content += '<p><strong>æ•…äº‹ï¼š</strong>å­ºå­ç‰›é›•å¡‘æ˜¯æ·±åœ³ç²¾ç¥çš„è±¡å¾ï¼Œä½“ç°äº†æ·±åœ³äººå¼€æ‹“è¿›å–ã€åŠ¡å®è‚¯å¹²çš„ç²¾ç¥é£è²Œã€‚</p>';
                content += '<div class="button-group">';
                content += '<button class="btn btn-danger" onclick="showVideo(4,\'history\')">ğŸ¬ å†å²å½±ç‰‡</button>';
                content += '<button class="btn btn-info" onclick="showVideo(4,\'story\')">ğŸ“– æ•…äº‹è¿›åº¦</button>';
                content += '</div>';
                content += '<p><strong>é—®é¢˜ï¼š</strong>å­ºå­ç‰›é›•å¡‘åˆå¸¸è¢«ç§°ä¸ºä»€ä¹ˆç‰›ï¼Ÿ</p>';
                content += '<input type="text" id="answer-4" placeholder="è¾“å…¥æ‚¨çš„ç­”æ¡ˆ">';
                content += '<div class="button-group">';
                content += '<button class="btn" onclick="checkAnswer(4,\'æ‹“è’ç‰›\')">æäº¤ç­”æ¡ˆ</button>';
                content += '<button class="btn btn-warning" onclick="showHint(4)">ğŸ’¡ æç¤º (<span id="hint-count-4">0</span>/3)</button>';
                content += '</div>';
                content += '<div class="selfie-box">';
                content += '<button class="btn btn-success" onclick="takeSelfie(4)">ğŸ“¸ è‡ªæ‹åˆ†äº«</button>';
                content += '<canvas id="canvas-4" class="selfie-canvas" width="600" height="600"></canvas>';
                content += '<img id="selfie-4" class="selfie-img" style="display:none;">';
                content += '</div>';
                content += '</div>';
            }
            else if (locationNum === 5) {
                content += '<div id="location-5" class="location-card">';
                content += '<h2>ğŸŒ‰ æ·±åœ³æ¹¾å¤§æ¡¥<span id="dist-5" class="distance-badge">è®¡ç®—ä¸­â€¦</span></h2>';
                content += '<p><strong>æ•…äº‹ï¼š</strong>æ·±åœ³æ¹¾å¤§æ¡¥æ˜¯è¿æ¥æ·±åœ³ä¸é¦™æ¸¯çš„é‡è¦é€šé“ï¼Œè±¡å¾ç€æ·±æ¸¯åˆä½œçš„ç´§å¯†å…³ç³»ã€‚</p>';
                content += '<div class="button-group">';
                content += '<button class="btn btn-danger" onclick="showVideo(5,\'history\')">ğŸ¬ å†å²å½±ç‰‡</button>';
                content += '<button class="btn btn-info" onclick="showVideo(5,\'story\')">ğŸ“– æ•…äº‹è¿›åº¦</button>';
                content += '</div>';
                content += '<p><strong>é—®é¢˜ï¼š</strong>æ·±åœ³æ¹¾å¤§æ¡¥è¿æ¥æ·±åœ³å’Œé¦™æ¸¯çš„å“ªä¸ªåœ°åŒºï¼Ÿ</p>';
                content += '<input type="text" id="answer-5" placeholder="è¾“å…¥æ‚¨çš„ç­”æ¡ˆ">';
                content += '<div class="button-group">';
                content += '<button class="btn" onclick="checkAnswer(5,\'å…ƒæœ—\')">æäº¤ç­”æ¡ˆ</button>';
                content += '<button class="btn btn-warning" onclick="showHint(5)">ğŸ’¡ æç¤º (<span id="hint-count-5">0</span>/3)</button>';
                content += '</div>';
                content += '<div class="selfie-box">';
                content += '<button class="btn btn-success" onclick="takeSelfie(5)">ğŸ“¸ è‡ªæ‹åˆ†äº«</button>';
                content += '<canvas id="canvas-5" class="selfie-canvas" width="600" height="600"></canvas>';
                content += '<img id="selfie-5" class="selfie-img" style="display:none;">';
                content += '</div>';
                content += '</div>';
            }
            else if (locationNum === 6) {
                content += '<div id="location-6" class="location-card">';
                content += '<h2>ğŸ—ï¸ å‰æµ·æ·±æ¸¯ç°ä»£æœåŠ¡ä¸šåˆä½œåŒº<span id="dist-6" class="distance-badge">è®¡ç®—ä¸­â€¦</span></h2>';
                content += '<p><strong>æ•…äº‹ï¼š</strong>å‰æµ·æ˜¯æ–°æ—¶ä»£æ”¹é©å¼€æ”¾çš„è¯•éªŒç”°ï¼Œè‡´åŠ›äºæ‰“é€ ç²¤æ¸¯æ¾³å¤§æ¹¾åŒºç°ä»£æœåŠ¡ä¸šä½“åˆ¶æœºåˆ¶åˆ›æ–°åŒºã€‚</p>';
                content += '<div class="button-group">';
                content += '<button class="btn btn-danger" onclick="showVideo(6,\'history\')">ğŸ¬ å†å²å½±ç‰‡</button>';
                content += '<button class="btn btn-info" onclick="showVideo(6,\'story\')">ğŸ“– æ•…äº‹è¿›åº¦</button>';
                content += '</div>';
                content += '<p><strong>é—®é¢˜ï¼š</strong>å‰æµ·åˆä½œåŒºé‡ç‚¹å‘å±•å“ªç±»äº§ä¸šï¼Ÿ</p>';
                content += '<input type="text" id="answer-6" placeholder="è¾“å…¥æ‚¨çš„ç­”æ¡ˆ">';
                content += '<div class="button-group">';
                content += '<button class="btn" onclick="checkAnswer(6,\'ç°ä»£æœåŠ¡ä¸š\')">æäº¤ç­”æ¡ˆ</button>';
                content += '<button class="btn btn-warning" onclick="showHint(6)">ğŸ’¡ æç¤º (<span id="hint-count-6">0</span>/3)</button>';
                content += '</div>';
                content += '<div class="selfie-box">';
                content += '<button class="btn btn-success" onclick="takeSelfie(6)">ğŸ“¸ è‡ªæ‹åˆ†äº«</button>';
                content += '<canvas id="canvas-6" class="selfie-canvas" width="600" height="600"></canvas>';
                content += '<img id="selfie-6" class="selfie-img" style="display:none;">';
                content += '</div>';
                content += '</div>';
            }
            
            document.getElementById('game-content').innerHTML = content;
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer(locationNum, correctAnswer) {
            var userAnswer = document.getElementById('answer-' + locationNum).value.trim().toLowerCase();
            var correct = correctAnswer.toLowerCase();
            var isCorrect = false;
            
            // ä¸¥æ ¼æ¯”å¯¹é€»è¾‘
            if (userAnswer === correct) {
                isCorrect = true;
            }
            // é’ˆå¯¹ç‰¹å®šé¢˜ç›®çš„å®½æ¾æ¯”å¯¹
            if (locationNum === 2 && (userAnswer === 'æ™ºèƒ½æ‰‹æœº' || userAnswer === 'ç”µå­')) {
                isCorrect = true;
            }

            if (isCorrect) {
                document.getElementById('answer-' + locationNum).value = '';
                showPoemThenNext(); // åªæœ‰æ­£ç¡®æ‰æ˜¾ç¤ºè¯—å¥
            } else {
                alert('âŒ ç­”æ¡ˆä¸æ­£ç¡®ï¼Œè¯·å†è¯•ä¸€æ¬¡æˆ–æŸ¥çœ‹æç¤ºã€‚');
            }
        }

        // æ˜¾ç¤ºæç¤º
        function showHint(locationNum) {
            hintCounters[locationNum]++;
            document.getElementById('hint-count-' + locationNum).textContent = hintCounters[locationNum];
            
            var hints = {
                1: {
                    1: 'æç¤ºï¼šè¿™ä¸ªè¡Œæ”¿åŒºæ˜¯æ·±åœ³çš„ä¸­å¿ƒåŸåŒºä¹‹ä¸€ã€‚', 
                    2: 'æç¤ºï¼šå¸‚æ°‘ä¸­å¿ƒã€ä¼šå±•ä¸­å¿ƒéƒ½åœ¨è¿™ä¸ªåŒºã€‚', 
                    3: 'ç­”æ¡ˆï¼šç¦ç”°åŒº'
                },
                2: {
                    1: 'æç¤ºï¼šè¿™æ˜¯ä¸€ç§äººäººéƒ½åœ¨ä½¿ç”¨çš„é€šè®¯è®¾å¤‡ã€‚', 
                    2: 'æç¤ºï¼šåå¼ºåŒ—ä»¥é”€å”®å’Œç»„è£…è¿™ç§è®¾å¤‡é—»åã€‚', 
                    3: 'ç­”æ¡ˆï¼šæ‰‹æœº'
                },
                3: {
                    1: 'æç¤ºï¼šè¿™ä¸ªæ–¹å‘ä¸ä¸­å›½æ”¹é©å¼€æ”¾çš„æ–¹å‘ä¸€è‡´ã€‚', 
                    2: 'æç¤ºï¼šé‚“å°å¹³é“œåƒé¢å‘é¦™æ¸¯çš„æ–¹å‘ã€‚', 
                    3: 'ç­”æ¡ˆï¼šå—æ–¹'
                },
                4: {
                    1: 'æç¤ºï¼šè¿™ä¸ªé›•å¡‘è±¡å¾ç€æ·±åœ³å¼€æ‹“è¿›å–çš„ç²¾ç¥ã€‚', 
                    2: 'æç¤ºï¼šè¿™ç§åŠ¨ç‰©è±¡å¾ç€å‹¤åŠ³å’Œå¼€æ‹“ã€‚', 
                    3: 'ç­”æ¡ˆï¼šæ‹“è’ç‰›'
                },
                5: {
                    1: 'æç¤ºï¼šè¿™æ˜¯é¦™æ¸¯çš„ä¸€ä¸ªåœ°åŒºã€‚', 
                    2: 'æç¤ºï¼šè¿™ä¸ªåœ°åŒºä½äºæ–°ç•Œè¥¿åŒ—éƒ¨ã€‚', 
                    3: 'ç­”æ¡ˆï¼šå…ƒæœ—'
                },
                6: {
                    1: 'æç¤ºï¼šè¿™æ˜¯ä¸€ç§éåˆ¶é€ ä¸šçš„äº§ä¸šç±»å‹ã€‚', 
                    2: 'æç¤ºï¼šåŒ…æ‹¬é‡‘èã€ç‰©æµã€ä¿¡æ¯æœåŠ¡ç­‰ã€‚', 
                    3: 'ç­”æ¡ˆï¼šç°ä»£æœåŠ¡ä¸š'
                }
            };
            
            alert(hints[locationNum][Math.min(hintCounters[locationNum], 3)]);
            
            if (hintCounters[locationNum] === 3) {
                setTimeout(function() { 
                    hintCounters[locationNum] = 0; 
                    document.getElementById('hint-count-' + locationNum).textContent = '0'; 
                }, 2000);
            }
        }

        // æ˜¾ç¤ºå½±ç‰‡
        function showVideo(locationNum, type) {
            var videoInfo = {
                1: {
                    history: {title: 'æ·±åœ³åšç‰©é¦†å†å²', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'æ·±åœ³æ”¹é©å¼€æ”¾æ•…äº‹', youtubeId: 'dQw4w9WgXcQ'}
                },
                2: {
                    history: {title: 'åå¼ºåŒ—å‘å±•å²', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'ä¸­å›½ç”µå­ç¬¬ä¸€è¡—', youtubeId: 'dQw4w9WgXcQ'}
                },
                3: {
                    history: {title: 'è²èŠ±å±±ä¸é‚“å°å¹³', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'æ·±åœ³åŸå¸‚ä¸­è½´çº¿', youtubeId: 'dQw4w9WgXcQ'}
                },
                4: {
                    history: {title: 'å­ºå­ç‰›é›•å¡‘æ•…äº‹', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'æ·±åœ³ç²¾ç¥è±¡å¾', youtubeId: 'dQw4w9WgXcQ'}
                },
                5: {
                    history: {title: 'æ·±åœ³æ¹¾å¤§æ¡¥å»ºè®¾', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'æ·±æ¸¯åˆä½œæ¡¥æ¢', youtubeId: 'dQw4w9WgXcQ'}
                },
                6: {
                    history: {title: 'å‰æµ·åˆä½œåŒºè§„åˆ’', youtubeId: 'dQw4w9WgXcQ'}, 
                    story: {title: 'æ–°æ—¶ä»£æ”¹é©å¼€æ”¾', youtubeId: 'dQw4w9WgXcQ'}
                }
            };
            
            var info = videoInfo[locationNum][type];
            document.getElementById('video-title').textContent = info.title;
            document.getElementById('video-description').textContent = info.title;
            document.getElementById('video-player').src = 'https://www.youtube.com/embed/' + info.youtubeId + '?autoplay=1&rel=0';
            document.getElementById('video-modal').style.display = 'flex';
        }

        // å…³é—­å½±ç‰‡
        function closeVideo() {
            document.getElementById('video-modal').style.display = 'none';
            document.getElementById('video-player').src = '';
        }

        // å®Œæˆæ¸¸æˆ
        function completeGame() {
            document.getElementById('game-content').innerHTML = '';
            
            var completionHTML = '<div id="completion" class="completion">';
            completionHTML += '<h2>ğŸ‰ æ­å–œæ‚¨å®Œæˆæ‰€æœ‰æ¢ç´¢ï¼</h2>';
            completionHTML += '<p>æ‚¨å·²æˆåŠŸå®Œæˆæ·±åœ³åŸå¸‚æ¢ç´¢çš„ 6 ä¸ªå†å²ä¸åœ°æ ‡åœ°ç‚¹ï¼</p>';
            completionHTML += '<div class="qr-code">';
            completionHTML += '<h3>å®Œæˆå¥–åŠ±äºŒç»´ç </h3>';
            completionHTML += '<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=æ·±åœ³åŸå¸‚æ¢ç´¢å®Œæˆ&format=png&margin=0" alt="å®Œæˆå¥–åŠ±">';
            completionHTML += '<p class="qr-instruction">æ‰«ææ­¤äºŒç»´ç å¯è·å¾—æ•°å­—ä»£ç </p>';
            completionHTML += '</div>';
            completionHTML += '<div class="selfie-box">';
            completionHTML += '<button class="btn btn-success" onclick="takeSelfie(0)">ğŸ“¸ è‡ªæ‹åˆ†äº«å®Œæˆä»»åŠ¡</button>';
            completionHTML += '<canvas id="canvas-0" class="selfie-canvas" width="600" height="600"></canvas>';
            completionHTML += '<img id="selfie-0" class="selfie-img" style="display:none;">';
            completionHTML += '</div>';
            completionHTML += '<button class="btn btn-success" onclick="resetGame()">é‡æ–°å¼€å§‹æ¸¸æˆ</button>';
            completionHTML += '</div>';
            
            document.getElementById('game-content').innerHTML = completionHTML;
            updateProgress();
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            currentLocation = 1;
            completedLocations.clear();
            hintCounters = {1:0, 2:0, 3:0, 4:0, 5:0, 6:0};
            loadGameContent();
            updateProgress();
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            loadGameContent();
            updateProgress();
        });

        // ç®€åŒ–çš„è‡ªæ‹åŠŸèƒ½
        function takeSelfie(locationNum) {
            var canvas = document.getElementById('canvas-' + locationNum);
            var ctx = canvas.getContext('2d');
            var img = document.getElementById('selfie-' + locationNum);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 600, 600);
            
            // ç»˜åˆ¶æ–‡å­—
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            
            var site = locationNum === 0 ? 'æ·±åœ³åŸå¸‚æ¢ç´¢' : getLocationName(locationNum);
            ctx.fillText('æˆ‘å·²å®Œæˆã€' + site + 'ã€‘ä»»åŠ¡ï¼', 300, 300);
            
            // ç»˜åˆ¶ç®€å•çš„ç›¸æœºå›¾æ ‡
            ctx.fillStyle = '#333333';
            ctx.fillRect(250, 400, 100, 80);
            ctx.fillStyle = '#cccccc';
            ctx.fillRect(270, 420, 60, 40);
            
            // æ˜¾ç¤ºå›¾ç‰‡
            var dataURL = canvas.toDataURL('image/jpeg', 0.9);
            img.src = dataURL;
            img.style.display = 'block';
            
            // æ¨¡æ‹Ÿåˆ†äº«åˆ°å¾®ä¿¡
            setTimeout(function() {
                if (confirm('æ˜¯å¦è¦åˆ†äº«åˆ°å¾®ä¿¡ï¼Ÿ')) {
                    alert('å·²ç”Ÿæˆåˆ†äº«å›¾ç‰‡ï¼Œè¯·ä¿å­˜ååˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ');
                }
            }, 500);
        }

        // è·å–åœ°ç‚¹åç§°
        function getLocationName(locationNum) {
            var locations = {
                1: 'æ·±åœ³åšç‰©é¦†',
                2: 'åå¼ºåŒ—ç”µå­å¸‚åœº',
                3: 'è²èŠ±å±±å…¬å›­',
                4: 'å­ºå­ç‰›é›•å¡‘',
                5: 'æ·±åœ³æ¹¾å¤§æ¡¥',
                6: 'å‰æµ·åˆä½œåŒº'
            };
            return locations[locationNum] || 'æœªçŸ¥åœ°ç‚¹';
        }

        // ç®€åŒ–çš„GPSåŠŸèƒ½
        function simulateGPS() {
            var distances = [150, 320, 85, 420, 210, 180];
            
            for (var i = 1; i <= 6; i++) {
                var badge = document.getElementById('dist-' + i);
                if (badge) {
                    badge.textContent = distances[i-1] + ' ç±³';
                    
                    // æ¨¡æ‹Ÿåˆ°è¾¾åœ°ç‚¹
                    if (distances[i-1] < 200 && !completedLocations.has(i)) {
                        showGPSPrompt(i);
                    }
                }
            }
        }

        // æ˜¾ç¤ºGPSæç¤º
        function showGPSPrompt(poiId) {
            var prompt = document.getElementById('gpsPrompt');
            var poiName = getLocationName(poiId);
            
            document.getElementById('promptPoiName').textContent = poiName;
            prompt.dataset.poiId = poiId;
            prompt.style.display = 'block';
            
            // 5ç§’åè‡ªåŠ¨éšè—
            setTimeout(function() {
                if (prompt.style.display === 'block') {
                    prompt.style.display = 'none';
                }
            }, 5000);
        }

        // å…³é—­GPSæç¤º
        function closePrompt() {
            document.getElementById('gpsPrompt').style.display = 'none';
        }

        // æ’­æ”¾é€‰æ‹©çš„å½±ç‰‡
        function playSelected(type) {
            var poiId = document.getElementById('gpsPrompt').dataset.poiId;
            closePrompt();
            showVideo(poiId, type === 'story' ? 'story' : 'history');
        }

        // åˆå§‹åŒ–GPSæ¨¡æ‹Ÿ
        setInterval(simulateGPS, 3000);
    </script>
</body>
</html>
